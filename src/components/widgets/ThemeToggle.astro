---
import { Icon } from 'astro-icon/components'
---

<button
	id='theme-toggle'
	type='button'
	class={`
		flex items-center justify-center rounded-lg p-2
		hover:bg-foreground/10
	`}
>
	<Icon id='icon-sun' name='material-symbols:light-mode-outline-rounded' size={24} class='hidden' />
	<Icon id='icon-moon' name='material-symbols:dark-mode-outline-rounded' size={24} class='hidden' />
</button>

<script is:inline>
	const theme = localStorage.getItem('theme')
	const isDark = theme !== 'light'
	document.documentElement.classList.toggle('dark', isDark)
	document.getElementById('icon-sun')?.classList.toggle('hidden', isDark)
	document.getElementById('icon-moon')?.classList.toggle('hidden', !isDark)
</script>

<script>
	type Theme = 'dark' | 'light'

	function getTheme(): Theme {
		const stored = localStorage.getItem('theme')
		return stored === 'light' ? 'light' : 'dark'
	}

	function setTheme(theme: Theme) {
		document.documentElement.classList.toggle('dark', theme === 'dark')
		localStorage.setItem('theme', theme)
		updateIcon(theme)
	}

	function updateIcon(theme: Theme) {
		const iconSun = document.getElementById('icon-sun')
		const iconMoon = document.getElementById('icon-moon')
		iconSun?.classList.toggle('hidden', theme === 'dark')
		iconMoon?.classList.toggle('hidden', theme === 'light')
	}

	function init() {
		updateIcon(getTheme())
		document.getElementById('theme-toggle')?.addEventListener('click', () => {
			setTheme(getTheme() === 'dark' ? 'light' : 'dark')
		})
	}

	init()
</script>
